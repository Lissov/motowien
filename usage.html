<!doctype html public "-//W3C//DTD HTML 4.01//EN"
  "http://www.w3.org/TR/html4/strict.dtd">

<html lang="de">
  <head>
    <meta charset="utf-8">
    <title>MotoWien</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/x-icon" href="images\motowien_icon.png">
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>

    <h1>Motorrad rund um Wien: Nutzerzahl</h1>
    <div class="menu">
      <a  href="index.html">Home</a>
      <a  href="trips.html">Routes</a>
      <a class="active" href="tech.html">Technologie</a>
      <a  href="docs/stb.html">Staatsb.</a>
    </div>
    <div class="page-content">
    <div class="content">
      <h5>Insgesamt seit beginn der Messung</h5>
      <p>
        Besuche: <span id="count-all">Loading...</span>
      </p>
      <p>
        Nutzer: <span id="count-all-user">Loading...</span>
      </p>

      <h5>Letzte 24 Stunden</h5>
      <p>
        Besuche: <span id="count-24h">Loading...</span>
      </p>
      <p>
        Nutzer: <span id="count-24h-user">Loading...</span>
      </p>

      <br/>
      <p>Alle "anonyous" Nutzer, wo der Nutzer Client-ID Tracking nicht erlaubt hat, sind als 1 Nutzer gezahlt.</p>
    </div>
    <script>
      var x = new XMLHttpRequest();
      x.open('GET', 'https://lissov.net/api/visitors/stats', false);
      x.onloadend = (res) => console.log(res);
      x.send();
    </script>

    </div>
    <div class="footer">
      <div class="footer-content">
        <p>2023 &#169; Pavlo Lissov</p>
        <p>Alle Rechte der Bilder liegen bei Pavlo Lissov</p>
        <p>Kontakt: <a href="mailto: admin@lissov.net?subject=MotoWien">Send email</a></p>  
      </div>
    </div>
    <script>
      var t = localStorage.getItem('allowTracking');
      if (t !== 'false') {
        var cid = t === 'true' ? localStorage.getItem('clientId') : 'anonymous';
        var x = new XMLHttpRequest();
        x.open('GET', 'https://lissov.net/api/visitors/log?pageName=usage.html&clientId=' + cid, true);
        x.send();
      }
    </script>
    
  </body>
</html>

<div id="tracking_warning" class="popup-bottom">
  <div class="tracking-inside">
    Die Webseite logiert Zahl der Benutzer. <a href="tech.html">Mehr Info hier...</a><br/>
    Bitte erlaube Tracking mit zuf√§lliges Client ID.
    <div class="buttons">
      <button class="primary" onclick="window.selectTracking('true')">Erlauben</button>
      <button onclick="window.selectTracking('anonymous')">Anonymes Tracking</button>
    </div>
  </div>
</div>
<script>
  var el = document.getElementById('tracking_warning');
  window['selectTracking'] = (option) => {
    var cid = localStorage.getItem('clientId');
    if (!cid) {
      var clientId = '';
      for (var i = 0; i < 20; i++) clientId += String.fromCharCode(97 + Math.floor(Math.random()*26));
      localStorage.setItem('clientId', clientId);
    }
    localStorage.setItem('allowTracking', option);
    location.reload();
  };
  var at = localStorage.getItem('allowTracking');
  if (!at || at === 'false') {
    setTimeout(() => el.classList.add('popup-bottom-appear'), 1);
  }
</script>

